(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const n=flarum.core.compat["admin/app"];var a=e.n(n);function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}const i=flarum.core.compat["common/Model"];var s=e.n(i),l=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).content=s().attribute("content"),t.is_suggested=s().attribute("is_suggested"),t.sort=s().attribute("sort"),t.field=s().hasOne("field"),t}return r(t,e),t.prototype.apiEndpoint=function(){return"/fof/mason/answers"+(this.exists?"/"+this.data.id:"")},t}(s());const d=flarum.core.compat["common/utils/computed"];var f=e.n(d),c=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).name=s().attribute("name"),t.description=s().attribute("description"),t.min_answers_count=s().attribute("min_answers_count"),t.max_answers_count=s().attribute("max_answers_count"),t.show_when_empty=s().attribute("show_when_empty"),t.user_values_allowed=s().attribute("user_values_allowed"),t.validation=s().attribute("validation"),t.icon=s().attribute("icon"),t.sort=s().attribute("sort"),t.deleted_at=s().attribute("deleted_at",s().transformDate),t.allAnswers=s().hasMany("allAnswers"),t.suggestedAnswers=s().hasMany("suggestedAnswers"),t.required=f()("min_answers_count",(function(e){return e>0})),t.multiple=f()("max_answers_count",(function(e){return e>1})),t}return r(t,e),t.prototype.apiEndpoint=function(){return"/fof/mason/fields"+(this.exists?"/"+this.data.id:"")},t}(s());function u(e,t,n){if(void 0===n)return e&&e.h5s&&e.h5s.data&&e.h5s.data[t];e.h5s=e.h5s||{},e.h5s.data=e.h5s.data||{},e.h5s.data[t]=n}var p=function(e,t){if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof t?Array.from(e):Array.from(e).filter((function(e){return 1===e.nodeType&&e.matches(t)}))},h=new Map,g=function(){function e(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(e.prototype,"config",{get:function(){var e={};return this._config.forEach((function(t,n){e[n]=t})),e},set:function(e){if("object"!=typeof e)throw new Error("You must provide a valid configuration object to the config setter.");var t=Object.assign({},e);this._config=new Map(Object.entries(t))},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e,t){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,t)},e.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&null!==e)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!1,configurable:!0}),e.prototype.setData=function(e,t){if("string"!=typeof e)throw new Error("The key must be a string.");this._data.set(e,t)},e.prototype.getData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.get(e)},e.prototype.deleteData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.delete(e)},e}(),v=function(e){if(!(e instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return h.has(e)||h.set(e,new g),h.get(e)};function w(e,t,n){if(e instanceof Array)for(var a=0;a<e.length;++a)w(e[a],t,n);else e.addEventListener(t,n),v(e).setData("event"+t,n)}function b(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)b(e[n],t);else e.removeEventListener(t,v(e).getData("event"+t)),v(e).deleteData("event"+t)}function y(e,t,n){if(e instanceof Array)for(var a=0;a<e.length;++a)y(e[a],t,n);else e.setAttribute(t,n)}function E(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)E(e[n],t);else e.removeAttribute(t)}var _,T,N,x,C,S,A,F,M,L=function(e){if(!e.parentElement||0===e.getClientRects().length)throw new Error("target element must be part of the dom");var t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}},P=function(e,t){if(!(e instanceof HTMLElement&&(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(t).indexOf(e)},H=function(e){if(!(e instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==e.parentNode},O=function(e,t,n){if(!(e instanceof HTMLElement&&e.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");e.parentElement.insertBefore(t,"before"===n?e:e.nextElementSibling)},B=function(e,t){return O(e,t,"after")},D=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var t=window.getComputedStyle(e);return"border-box"===t.getPropertyValue("box-sizing")?parseInt(t.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map((function(e){var n=parseInt(t.getPropertyValue(e),10);return isNaN(n)?0:n})).reduce((function(e,t){return e+t}))},I=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var t=window.getComputedStyle(e);return["width","padding-left","padding-right"].map((function(e){var n=parseInt(t.getPropertyValue(e),10);return isNaN(n)?0:n})).reduce((function(e,t){return e+t}))},j=function(e,t){if(!(e instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof t?e:e.filter((function(e){return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement})).map((function(e){return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)}))},k=function(e){return e.composedPath&&e.composedPath()[0]||e.target},Y=function(e,t,n){return{element:e,posX:n.pageX-t.left,posY:n.pageY-t.top}},q=function(e,t){if(!0===e.isSortable){var n=v(e).getConfig("acceptFrom");if(null!==n&&!1!==n&&"string"!=typeof n)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==n)return!1!==n&&n.split(",").filter((function(e){return e.length>0&&t.matches(e)})).length>0;if(e===t)return!0;if(void 0!==v(e).getConfig("connectWith")&&null!==v(e).getConfig("connectWith"))return v(e).getConfig("connectWith")===v(t).getConfig("connectWith")}return!1},z={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"},U=function(e){b(e,"dragstart"),b(e,"dragend"),b(e,"dragover"),b(e,"dragenter"),b(e,"drop"),b(e,"mouseenter"),b(e,"mouseleave")},W=function(e,t){e&&b(e,"dragleave"),t&&t!==e&&b(t,"dragleave")},R=function(e){var t;(t=e).h5s&&delete t.h5s.data,E(e,"aria-dropeffect")},X=function(e){E(e,"aria-grabbed"),E(e,"aria-copied"),E(e,"draggable"),E(e,"role")};function G(e,t){if(t.composedPath)return t.composedPath().find((function(e){return e.isSortable}));for(;!0!==e.isSortable;)e=e.parentElement;return e}function V(e,t){var n=u(e,"opts"),a=p(e.children,n.items).filter((function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)}));return a.length>0?a[0]:t}var J=function(e){var t=u(e,"opts"),n=p(e.children,t.items),a=j(n,t.handle);y(e,"aria-dropeffect","move"),u(e,"_disabled","false"),y(a,"draggable","true"),!1===t.disableIEFix&&"function"==typeof(document||window.document).createElement("span").dragDrop&&w(a,"mousedown",(function(){if(-1!==n.indexOf(this))this.dragDrop();else{for(var e=this.parentElement;-1===n.indexOf(e);)e=e.parentElement;e.dragDrop()}}))};function K(e,t){var n=String(t);return t=t||{},"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),e=Array.prototype.slice.call(e),/serialize/.test(n)?e.map((function(e){var t=u(e,"opts");return function(e,t,n){if(void 0===t&&(t=function(e,t){return e}),void 0===n&&(n=function(e){return e}),!(e instanceof HTMLElement)||1==!e.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof t||"function"!=typeof n)throw new Error("You need to provide a valid serializer for items and the container.");var a=u(e,"opts").items,o=p(e.children,a),r=o.map((function(t){return{parent:e,node:t,html:t.outerHTML,index:P(t,o)}}));return{container:n({node:e,itemCount:r.length}),items:r.map((function(n){return t(n,e)}))}}(e,t.itemSerializer,t.containerSerializer)})):(e.forEach((function(e){if(/enable|disable|destroy/.test(n))return K[n](e);["connectWith","disableIEFix"].forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&null!==t[e]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+e+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')})),t=Object.assign({},z,v(e).config,t),v(e).config=t,u(e,"opts",t),e.isSortable=!0,function(e){var t=u(e,"opts"),n=p(e.children,t.items),a=j(n,t.handle);u(e,"_disabled","false"),U(n),W(x,F),b(a,"mousedown"),b(e,"dragover"),b(e,"dragenter"),b(e,"drop")}(e);var a,o=p(e.children,t.items);if(null!==t.placeholder&&void 0!==t.placeholder){var r=document.createElement(e.tagName);t.placeholder instanceof HTMLElement?r.appendChild(t.placeholder):r.innerHTML=t.placeholder,a=r.children[0]}v(e).placeholder=function(e,t,n){var a;if(void 0===n&&(n="sortable-placeholder"),!(e instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(t instanceof HTMLElement)&&void 0!==t)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===t&&(["UL","OL"].includes(e.tagName)?t=document.createElement("li"):["TABLE","TBODY"].includes(e.tagName)?(t=document.createElement("tr")).innerHTML='<td colspan="100"></td>':t=document.createElement("div")),"string"==typeof n&&(a=t.classList).add.apply(a,n.split(" ")),t}(e,a,t.placeholderClass),u(e,"items",t.items),t.acceptFrom?u(e,"acceptFrom",t.acceptFrom):t.connectWith&&u(e,"connectWith",t.connectWith),J(e),y(o,"role","option"),y(o,"aria-grabbed","false"),function(e,t){if("string"==typeof v(e).getConfig("hoverClass")){var n=v(e).getConfig("hoverClass").split(" ");!0===t?(w(e,"mousemove",function(e,t){var n=this;if(void 0===t&&(t=250),"number"!=typeof t)throw new Error("You must provide a number as the second argument for throttle.");var a=null;return function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var i=Date.now();(null===a||i-a>=t)&&(a=i,e.apply(n,o))}}((function(t){0===t.buttons&&p(e.children,v(e).getConfig("items")).forEach((function(e){var a,o;e!==t.target?(a=e.classList).remove.apply(a,n):(o=e.classList).add.apply(o,n)}))}),v(e).getConfig("throttleTime"))),w(e,"mouseleave",(function(){p(e.children,v(e).getConfig("items")).forEach((function(e){var t;(t=e.classList).remove.apply(t,n)}))}))):(b(e,"mousemove"),b(e,"mouseleave"))}}(e,!0),w(e,"dragstart",(function(e){var n=k(e);if(!0!==n.isSortable&&(e.stopImmediatePropagation(),(!t.handle||n.matches(t.handle))&&"false"!==n.getAttribute("draggable"))){var a=G(n,e),o=V(a,n);A=p(a.children,t.items),C=A.indexOf(o),S=P(o,a.children),x=a,function(e,t,n){if(!(e instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(t instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(n||(n=Y),e.dataTransfer&&e.dataTransfer.setDragImage){var a=n(t,L(t),e);if(!(a.element instanceof HTMLElement)||"number"!=typeof a.posX||"number"!=typeof a.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",k(e).id),e.dataTransfer.setDragImage(a.element,a.posX,a.posY)}}(e,o,t.customDragImage),T=D(o),N=I(o),o.classList.add(t.draggingClass),_=function(e,t){var n=e;return!0===v(t).getConfig("copy")&&(y(n=e.cloneNode(!0),"aria-copied","true"),e.parentElement.appendChild(n),n.style.display="none",n.oldDisplay=e.style.display),n}(o,a),y(_,"aria-grabbed","true"),a.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:S,index:C,container:x},item:_,originalTarget:n}}))}})),w(e,"dragenter",(function(n){var a=k(n),o=G(a,n);o&&o!==F&&(M=p(o.children,u(o,"items")).filter((function(t){return t!==v(e).placeholder})),t.dropTargetContainerClass&&o.classList.add(t.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:S,index:C,container:x},destination:{container:o,itemsBeforeUpdate:M},item:_,originalTarget:a}})),w(o,"dragleave",(function(e){var n=e.relatedTarget||e.fromElement;e.currentTarget.contains(n)||(t.dropTargetContainerClass&&o.classList.remove(t.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:S,index:C,container:o},item:_,originalTarget:a}})))}))),F=o})),w(e,"dragend",(function(n){if(_){_.classList.remove(t.draggingClass),y(_,"aria-grabbed","false"),"true"===_.getAttribute("aria-copied")&&"true"!==u(_,"dropped")&&_.remove(),_.style.display=_.oldDisplay,delete _.oldDisplay;var a=Array.from(h.values()).map((function(e){return e.placeholder})).filter((function(e){return e instanceof HTMLElement})).filter(H)[0];a&&a.remove(),e.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:S,index:C,container:x},item:_}})),F=null,_=null,T=null,N=null}})),w(e,"drop",(function(n){if(q(e,_.parentElement)){n.preventDefault(),n.stopPropagation(),u(_,"dropped","true");var a=Array.from(h.values()).map((function(e){return e.placeholder})).filter((function(e){return e instanceof HTMLElement})).filter(H)[0];B(a,_),a.remove(),e.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:S,index:C,container:x},item:_}}));var o=v(e).placeholder,r=p(x.children,t.items).filter((function(e){return e!==o})),i=!0===this.isSortable?this:this.parentElement,s=p(i.children,u(i,"items")).filter((function(e){return e!==o})),l=P(_,Array.from(_.parentElement.children).filter((function(e){return e!==o}))),d=P(_,s);t.dropTargetContainerClass&&i.classList.remove(t.dropTargetContainerClass),S===l&&x===i||e.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:S,index:C,container:x,itemsBeforeUpdate:A,items:r},destination:{index:d,elementIndex:l,container:i,itemsBeforeUpdate:M,items:s},item:_}}))}}));var i,s,l,d=(i=function(e,n,a,o){if(_)if(t.forcePlaceholderSize&&(v(e).placeholder.style.height=T+"px",v(e).placeholder.style.width=N+"px"),Array.from(e.children).indexOf(n)>-1){var r=D(n),i=I(n),s=P(v(e).placeholder,n.parentElement.children),l=P(n,n.parentElement.children);if(r>T||i>N){var d=r-T,f=i-N,c=L(n).top,m=L(n).left;if(s<l&&("vertical"===t.orientation&&o<c||"horizontal"===t.orientation&&a<m))return;if(s>l&&("vertical"===t.orientation&&o>c+r-d||"horizontal"===t.orientation&&a>m+i-f))return}void 0===_.oldDisplay&&(_.oldDisplay=_.style.display),"none"!==_.style.display&&(_.style.display="none");var u=!1;try{var g=L(n).top+n.offsetHeight/2,w=L(n).left+n.offsetWidth/2;u="vertical"===t.orientation&&o>=g||"horizontal"===t.orientation&&a>=w}catch(e){u=s<l}u?B(n,v(e).placeholder):function(e,t){O(e,t,"before")}(n,v(e).placeholder),Array.from(h.values()).filter((function(e){return void 0!==e.placeholder})).forEach((function(t){t.placeholder!==v(e).placeholder&&t.placeholder.remove()}))}else{var b=Array.from(h.values()).filter((function(e){return void 0!==e.placeholder})).map((function(e){return e.placeholder}));-1!==b.indexOf(n)||e!==n||p(n.children,t.items).length||(b.forEach((function(e){return e.remove()})),n.appendChild(v(e).placeholder))}},void 0===(s=t.debounce)&&(s=0),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];clearTimeout(l),l=setTimeout((function(){i.apply(void 0,e)}),s)}),f=function(e){var t=e.target,n=!0===t.isSortable?t:G(t,e);if(t=V(n,t),_&&q(n,_.parentElement)&&"true"!==u(n,"_disabled")){var a=u(n,"opts");parseInt(a.maxItems)&&p(n.children,u(n,"items")).length>=parseInt(a.maxItems)&&_.parentElement!==n||(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=!0===v(n).getConfig("copy")?"copy":"move",d(n,t,e.pageX,e.pageY))}};w(o.concat(e),"dragover",f),w(o.concat(e),"dragenter",f)})),e)}K.destroy=function(e){!function(e){var t=u(e,"opts")||{},n=p(e.children,t.items),a=j(n,t.handle);b(e,"dragover"),b(e,"dragenter"),b(e,"dragstart"),b(e,"dragend"),b(e,"drop"),R(e),b(a,"mousedown"),U(n),X(n),W(x,F),e.isSortable=!1}(e)},K.enable=function(e){J(e)},K.disable=function(e){!function(e){var t=u(e,"opts"),n=p(e.children,t.items),a=j(n,t.handle);y(e,"aria-dropeffect","none"),u(e,"_disabled","true"),y(a,"draggable","false"),b(a,"mousedown")}(e)},K.__testing={_data:u,_removeItemEvents:U,_removeItemData:X,_removeSortableData:R,_removeContainerEvents:W};const Q=K,Z=flarum.core.compat["admin/components/ExtensionPage"];var ee=e.n(Z);const te=flarum.core.compat["common/utils/throttleDebounce"],ne=flarum.core.compat["common/helpers/icon"];var ae=e.n(ne);const oe=flarum.core.compat["common/utils/extractText"];var re=e.n(oe);const ie=flarum.core.compat["common/Component"];var se=e.n(ie);const le=flarum.core.compat["common/components/Button"];var de=e.n(le);const fe=flarum.core.compat["common/components/Switch"];var ce=e.n(fe),me=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.answer=this.attrs.answer,this.dirty=!1,this.processing=!1},n.view=function(){var e=this;return m("div",{className:"Mason-Box"},this.answer.is_suggested()&&[m("span",{className:"fas fa-arrows-alt Mason-Box--handle js-answer-handle"})," "],m("span",{onclick:function(){var t=prompt(re()(a().translator.trans("fof-mason.admin.buttons.edit-answer-prompt")),e.answer.content());t&&e.updateAttribute("content",t)},title:re()(a().translator.trans("fof-mason.admin.buttons.edit-answer"))},this.answer.content()," ",ae()("fas fa-pen")),m(ce(),{state:this.answer.is_suggested(),onchange:function(t){e.updateAttribute("is_suggested",t),e.saveAnswer()}},a().translator.trans("fof-mason.admin.fields.is_suggested")),m("div",{className:"ButtonGroup"},m(de(),{className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave(),onclick:this.saveAnswer.bind(this)},a().translator.trans("fof-mason.admin.buttons.save-answer")),m(de(),{className:"Button Button--danger",loading:this.processing,onclick:this.deleteAnswer.bind(this)},a().translator.trans("fof-mason.admin.buttons.delete-answer"))))},n.updateAttribute=function(e,t){var n;this.answer.pushAttributes(((n={})[e]=t,n)),this.dirty=!0},n.readyToSave=function(){return this.dirty},n.saveAnswer=function(){var e=this;this.processing=!0,this.answer.save(this.answer.data.attributes).then((function(){e.processing=!1,e.dirty=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t}))},n.deleteAnswer=function(){var e=this;confirm(re()(a().translator.trans("fof-mason.admin.messages.delete-answer-confirmation",{content:this.answer.content()})))&&(this.processing=!0,this.answer.delete().then((function(){e.processing=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t})))},t}(se());function ue(e,t){return t||(t="sort"),e.sort((function(e,n){return e[t]()-n[t]()}))}var pe=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).sortingChanged=(0,te.debounce)(500,(function(){var e=t.$(".js-answer-data").map((function(){return $(this).data("id")})).get();t.updateSort(e)})),t}r(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.field=this.attrs.field,this.processing=!1,this.new_content="",this.showUserAnswers=!1},n.configSortable=function(){var e=this.element.querySelector(".js-answers-container");if(e){var t=Q(e,{handle:".js-answer-handle"})[0];t.removeEventListener("sortupdate",this.sortingChanged),t.addEventListener("sortupdate",this.sortingChanged)}},n.oncreate=function(t){e.prototype.oncreate.call(this,t),this.configSortable()},n.onupdate=function(){this.configSortable()},n.view=function(){var e=this;if(!this.field.exists)return m("div",null,a().translator.trans("fof-mason.admin.fields.save-field-for-answers"));var t=[],n=[];return(this.field.allAnswers()||[]).forEach((function(e){void 0!==e&&(e.is_suggested()?t.push(e):n.push(e))})),[m("div",null,m("div",{className:"Mason-Container js-answers-container"},ue(t).map((function(e){return m("div",{className:"js-answer-data",key:e.id(),"data-id":e.id()},m(me,{answer:e}))}))),n.length&&m("[",null,m("button",{className:"Button Button--block Mason-Box-Header",onclick:function(){e.showUserAnswers=!e.showUserAnswers}},m("div",{className:"Mason-Box-Header-Title"},a().translator.trans("fof-mason.admin.buttons.show-user-answers",{count:n.length})),m("div",null,ae()("fas fa-chevron-"+(this.showUserAnswers?"up":"down")))),this.showUserAnswers&&m("div",{className:"Mason-Container"},ue(n,"content").map((function(e){return m("div",{key:e.id()},m(me,{answer:e}))}))))),m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.fields.new-answer"),m("input",{className:"FormControl",value:this.new_content,oninput:function(t){e.new_content=t.target.value},placeholder:a().translator.trans("fof-mason.admin.fields.new-answer-placeholder")}))),m("div",{className:"Form-group"},m(de(),{className:"Button Button--primary",loading:this.processing,disabled:!this.new_content,onclick:this.saveField.bind(this)},a().translator.trans("fof-mason.admin.buttons.add-answer")))]},n.saveField=function(){var e=this;this.processing=!0,a().request({method:"POST",url:a().forum.attribute("apiUrl")+this.field.apiEndpoint()+"/answers",body:{data:{attributes:{content:this.new_content,is_suggested:!0}}}}).then((function(t){a().store.pushPayload(t),e.new_content="",e.processing=!1,m.redraw()}))},n.updateSort=function(e){a().request({method:"POST",url:a().forum.attribute("apiUrl")+this.field.apiEndpoint()+"/answers/order",body:{sort:e}}).then((function(e){a().store.pushPayload(e),m.redraw()}))},t}(se()),he=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.field=this.attrs.field,this.dirty=!1,this.processing=!1,this.toggleFields=!1,this.field||this.initNewField()},n.initNewField=function(){this.field=a().store.createRecord("mason-fields",{attributes:{name:"",description:"",min_answers_count:0,max_answers_count:1,user_values_allowed:!1,show_when_empty:!1,validation:"",icon:""}})},n.boxTitle=function(){return this.field.exists?this.field.name():a().translator.trans("fof-mason.admin.buttons.new-field")},n.view=function(){var e=this;return m("div",{className:"Mason-Box"},this.field.exists&&m("span",{className:"fas fa-arrows-alt Mason-Box--handle js-field-handle"}),m("button",{className:"Button Button--block Mason-Box-Header",onclick:function(){e.toggleFields=!e.toggleFields}},m("div",{className:"Mason-Box-Header-Title"},this.boxTitle()),m("div",null,this.field.exists&&a().translator.trans("fof-mason.admin.buttons.edit-field")+" ",ae()("fas fa-chevron-"+(this.toggleFields?"up":"down")))),this.toggleFields&&this.viewFields())},n.viewFields=function(){var e=this;return[m("div",{className:"Mason-Box--row"},m("div",{className:"Mason-Box--column"},m("h4",null,a().translator.trans("fof-mason.admin.titles.field-settings")),m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.fields.name"),m("input",{className:"FormControl",value:this.field.name(),oninput:function(t){e.updateAttribute("name",t.target.value)}}),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.fields.name-help")))),m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.fields.description"),m("input",{className:"FormControl",value:this.field.description(),oninput:function(t){e.updateAttribute("description",t.target.value)}}),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.fields.description-help")))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:1===this.field.min_answers_count(),onchange:function(t){return e.updateAttribute("min_answers_count",t?1:0)}},a().translator.trans("fof-mason.admin.fields.required")))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:this.field.show_when_empty(),onchange:this.updateAttribute.bind(this,"show_when_empty")},a().translator.trans("fof-mason.admin.fields.show_when_empty"))),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.fields.show_when_empty-help"))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:this.field.user_values_allowed(),onchange:this.updateAttribute.bind(this,"user_values_allowed")},a().translator.trans("fof-mason.admin.fields.user_values_allowed"))),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.fields.user_values_allowed-help"))),m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.fields.validation"),m("input",{className:"FormControl",disabled:!this.field.user_values_allowed(),placeholder:this.field.user_values_allowed()?"":a().translator.trans("fof-mason.admin.fields.enable-user-values-for-validation"),value:this.field.validation(),oninput:function(t){e.updateAttribute("validation",t.target.value)}}),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.fields.validation-help",{a:m("a",{href:"https://laravel.com/docs/6.x/validation#available-validation-rules",target:"_blank"})})))),m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.fields.icon")," ",this.iconPreview(this.field.icon()),m("input",{className:"FormControl",value:this.field.icon(),oninput:function(t){e.updateAttribute("icon",t.target.value)}})),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.fields.icon-help",{a:m("a",{href:"https://fontawesome.com/icons?m=free",target:"_blank"})}))),m("div",{className:"Mason-Box--column"},m("h4",null,a().translator.trans("fof-mason.admin.titles.field-answers")),m("div",{className:"Form-group"},m(pe,{field:this.field}))))),m("div",{className:"ButtonGroup"},m(de(),{className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave(),onclick:this.saveField.bind(this)},a().translator.trans("fof-mason.admin.buttons."+(this.field.exists?"save":"add")+"-field")),this.field.exists&&m(de(),{className:"Button Button--danger",loading:this.processing,onclick:this.deleteField.bind(this)},a().translator.trans("fof-mason.admin.buttons.delete-field")))]},n.updateAttribute=function(e,t){var n;this.field.pushAttributes(((n={})[e]=t,n)),this.dirty=!0},n.readyToSave=function(){return this.dirty},n.saveField=function(){var e=this;this.processing=!0;var t=!this.field.exists;this.field.save(this.field.data.attributes).then((function(){t&&(e.initNewField(),e.toggleFields=!1),e.processing=!1,e.dirty=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t}))},n.deleteField=function(){var e=this;confirm(re()(a().translator.trans("fof-mason.admin.messages.delete-field-confirmation",{name:this.field.name()})))&&(this.processing=!0,this.field.delete().then((function(){e.processing=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t})))},n.iconPreview=function(e){return e?[" (",a().translator.trans("fof-mason.admin.fields.icon-preview",{preview:ae()(e)}),")"]:""},t}(se());const ge=flarum.core.compat["common/utils/saveSettings"];var ve=e.n(ge);const we=flarum.core.compat["common/components/Select"];var be=e.n(we),ye=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.fieldsSectionTitle=a().data.settings["fof-mason.fields-section-title"]||"",this.columnCount=a().data.settings["fof-mason.column-count"]||1,this.labelsAsPlaceholders=a().data.settings["fof-mason.labels-as-placeholders"]>0,this.fieldsInHero=a().data.settings["fof-mason.fields-in-hero"]>0,this.hideEmptyFieldsSection=a().data.settings["fof-mason.hide-empty-fields-section"]>0,this.tagsAsFields=a().data.settings["fof-mason.tags-as-fields"]>0,this.tagsFieldName=a().data.settings["fof-mason.tags-field-name"]||"",this.columnOptions={};for(var n=1;n<=3;n++)this.columnOptions[n]=a().translator.trans("fof-mason.admin.settings.n-columns",{count:n})},n.view=function(){var e=this;return m("div",{className:"Mason-Container"},m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.settings.fields-section-title"),m("input",{className:"FormControl",value:this.fieldsSectionTitle,placeholder:a().translator.trans("fof-mason.admin.settings.fields-section-title-placeholder"),onchange:function(t){e.updateSetting("fieldsSectionTitle","fof-mason.fields-section-title",t.target.value)}})),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.settings.fields-section-title-help"))),m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.settings.column-count"),",",m(be(),{options:this.columnOptions,value:this.columnCount,onchange:this.updateSetting.bind(this,"columnCount","fof-mason.column-count")}))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:this.labelsAsPlaceholders,onchange:this.updateSetting.bind(this,"labelsAsPlaceholders","fof-mason.labels-as-placeholders")},a().translator.trans("fof-mason.admin.settings.labels-as-placeholders"))),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.settings.labels-as-placeholders-help"))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:this.fieldsInHero,onchange:this.updateSetting.bind(this,"fieldsInHero","fof-mason.fields-in-hero")},a().translator.trans("fof-mason.admin.settings.fields-in-hero")))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:this.hideEmptyFieldsSection,onchange:this.updateSetting.bind(this,"hideEmptyFieldsSection","fof-mason.hide-empty-fields-section")},a().translator.trans("fof-mason.admin.settings.hide-empty-fields-section"))),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.settings.hide-empty-fields-section-help"))),m("div",{className:"Form-group"},m("label",null,m(ce(),{state:this.tagsAsFields,onchange:this.updateSetting.bind(this,"tagsAsFields","fof-mason.tags-as-fields")},a().translator.trans("fof-mason.admin.settings.tags-as-field"))),m("div",{className:"helpText"},a().translator.trans("fof-mason.admin.settings.tags-as-field-help"))),this.tagsAsFields&&m("div",{className:"Form-group"},m("label",null,a().translator.trans("fof-mason.admin.settings.tags-field-name")),m("input",{className:"FormControl",value:this.tagsFieldName,placeholder:a().translator.trans("fof-mason.admin.settings.tags-field-name-placeholder"),onchange:function(t){e.updateSetting("tagsFieldName","fof-mason.tags-field-name",t.target.value)}})))},n.updateSetting=function(e,t,n){var a;ve()(((a={})[t]=n,a)),this[e]=n},t}(se()),Ee=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).sortingChanged=(0,te.debounce)(500,(function(){var e=t.$(".js-field-data").map((function(){return $(this).data("id")})).get();t.updateSort(e)})),t}r(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),a().request({method:"GET",url:a().forum.attribute("apiUrl")+"/fof/mason/fields"}).then((function(e){a().store.pushPayload(e),m.redraw()}))},n.configSortable=function(){var e=Q(this.element.querySelector(".js-fields-container"),{handle:".js-field-handle"})[0];e.removeEventListener("sortupdate",this.sortingChanged),e.addEventListener("sortupdate",this.sortingChanged)},n.oncreate=function(t){e.prototype.oncreate.call(this,t),this.configSortable()},n.onupdate=function(){this.configSortable()},n.content=function(){var e=a().store.all("mason-fields"),t=[];return ue(e).forEach((function(e){t.push(m("div",{className:"js-field-data",key:e.id(),"data-id":e.id()},m(he,{field:e})))})),m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("h2",null,a().translator.trans("fof-mason.admin.titles.fields")),m("div",{className:"Mason-Container"},m("div",{className:"js-fields-container"},t),m(he,null)),m("h2",null,a().translator.trans("fof-mason.admin.titles.settings")),m(ye,null)))},n.updateSort=function(e){a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/fof/mason/fields/order",body:{sort:e}}).then((function(e){a().store.pushPayload(e),m.redraw()}))},t}(ee());a().initializers.add("fof-mason",(function(){a().store.models["mason-fields"]=c,a().store.models["mason-answers"]=l,a().extensionData.for("fof-mason").registerPage(Ee).registerPermission({icon:"fas fa-eye",label:a().translator.trans("fof-mason.admin.permissions.see-own-fields"),permission:"fof-mason.see-own-fields"},"view").registerPermission({icon:"fas fa-eye",label:a().translator.trans("fof-mason.admin.permissions.see-other-fields"),permission:"fof-mason.see-other-fields",allowGuest:!0},"view").registerPermission({icon:"fas fa-tasks",label:a().translator.trans("fof-mason.admin.permissions.fill-fields"),permission:"fof-mason.fill-fields"},"reply").registerPermission({icon:"fas fa-edit",label:a().translator.trans("fof-mason.admin.permissions.update-own-fields"),permission:"fof-mason.update-own-fields"},"reply").registerPermission({icon:"fas fa-edit",label:a().translator.trans("fof-mason.admin.permissions.update-other-fields"),permission:"fof-mason.update-other-fields",allowGuest:!0},"moderate").registerPermission({icon:"fas fa-forward",label:a().translator.trans("fof-mason.admin.permissions.skip-required-fields"),permission:"fof-mason.skip-required-fields"},"moderate")}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map