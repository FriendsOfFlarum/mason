module.exports=function(t){var n={};function a(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=n,a.d=function(t,n,e){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var s in t)a.d(e,s,function(n){return t[n]}.bind(null,s));return e},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=29)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat.Model},function(t,n,a){"use strict";function e(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}a.d(n,"a",function(){return e})},function(t,n){t.exports=flarum.core.compat.Component},function(t,n){t.exports=flarum.core.compat.extend},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n,a){"use strict";n.a=function(t,n){return void 0===n&&(n="sort"),t.sort(function(t,a){return t[n]()-a[n]()})}},function(t,n){t.exports=flarum.core.compat["components/Switch"]},function(t,n){t.exports=flarum.core.compat["utils/mixin"]},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n,a){"use strict";a.d(n,"a",function(){return r});var e=a(2),s=(a(0),a(1)),o=a.n(s),i=a(9),r=function(t){function n(){return t.apply(this,arguments)||this}return Object(e.a)(n,t),n.prototype.apiEndpoint=function(){return"/flagrow/mason/answers"+(this.exists?"/"+this.data.id:"")},n}(a.n(i)()(o.a,{content:o.a.attribute("content"),is_suggested:o.a.attribute("is_suggested"),sort:o.a.attribute("sort"),field:o.a.hasOne("field")}))},function(t,n){t.exports=flarum.core.compat["utils/computed"]},function(t,n,a){"use strict";a.d(n,"a",function(){return m});var e=a(2),s=(a(0),a(1)),o=a.n(s),i=a(9),r=a.n(i),l=a(12),d=a.n(l),m=function(t){function n(){return t.apply(this,arguments)||this}return Object(e.a)(n,t),n.prototype.apiEndpoint=function(){return"/flagrow/mason/fields"+(this.exists?"/"+this.data.id:"")},n}(r()(o.a,{name:o.a.attribute("name"),description:o.a.attribute("description"),min_answers_count:o.a.attribute("min_answers_count"),max_answers_count:o.a.attribute("max_answers_count"),show_when_empty:o.a.attribute("show_when_empty"),user_values_allowed:o.a.attribute("user_values_allowed"),validation:o.a.attribute("validation"),icon:o.a.attribute("icon"),sort:o.a.attribute("sort"),deleted_at:o.a.attribute("deleted_at",o.a.transformDate),all_answers:o.a.hasMany("all_answers"),suggested_answers:o.a.hasMany("suggested_answers"),required:d()("min_answers_count",function(t){return t>0}),multiple:d()("max_answers_count",function(t){return t>1})}))},,,,,,,,,,function(t,n){t.exports=flarum.core.compat["components/AdminNav"]},function(t,n){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,n){t.exports=flarum.core.compat["utils/saveSettings"]},function(t,n){t.exports=flarum.core.compat["components/Select"]},function(t,n){t.exports=flarum.core.compat["components/PermissionGrid"]},,function(t,n,a){"use strict";a.r(n);var e=a(0),s=a.n(e),o=a(11),i=a(13),r=a(4),l=a(23),d=a.n(l),u=a(24),c=a.n(u),f=a(2),p=a(3),h=a.n(p),g=a(5),w=a.n(g),b=a(6),v=a.n(b),_=a(8),y=a.n(_),x=function(t){function n(){return t.apply(this,arguments)||this}Object(f.a)(n,t);var a=n.prototype;return a.init=function(){this.answer=this.props.answer,this.dirty=!1,this.processing=!1},a.view=function(){var t=this;return m("form.Mason-Box",[this.answer.is_suggested()?[m("span.fa.fa-arrows.Mason-Box--handle.js-answer-handle")," "]:null,m("span",{onclick:function(){var n=prompt("Edit content",t.answer.content());n&&t.updateAttribute("content",n)}},[this.answer.content()," ",w()("fas fa-pen")]),y.a.component({state:this.answer.is_suggested(),onchange:function(n){t.updateAttribute("is_suggested",n),t.saveAnswer()},children:s.a.translator.trans("flagrow-mason.admin.fields.is_suggested")}),m(".ButtonGroup",[v.a.component({type:"submit",className:"Button Button--primary",children:s.a.translator.trans("flagrow-mason.admin.buttons.save-answer"),loading:this.processing,disabled:!this.readyToSave(),onclick:this.saveAnswer.bind(this)}),v.a.component({type:"submit",className:"Button Button--danger",children:s.a.translator.trans("flagrow-mason.admin.buttons.delete-answer"),loading:this.processing,onclick:this.deleteAnswer.bind(this)})])])},a.updateAttribute=function(t,n){var a;this.answer.pushAttributes(((a={})[t]=n,a)),this.dirty=!0},a.readyToSave=function(){return this.dirty},a.saveAnswer=function(){var t=this;this.processing=!0,this.answer.save(this.answer.data.attributes).then(function(){t.processing=!1,t.dirty=!1,m.redraw()}).catch(function(n){throw t.processing=!1,n})},a.deleteAnswer=function(){var t=this;confirm(s.a.translator.trans("flagrow-mason.admin.messages.delete-answer-confirmation",{content:this.answer.content()}))&&(this.processing=!0,this.answer.delete().then(function(){t.processing=!1,m.redraw()}).catch(function(n){throw t.processing=!1,n}))},n}(h.a),F=a(7),A=function(t){function n(){return t.apply(this,arguments)||this}Object(f.a)(n,t);var a=n.prototype;return a.init=function(){this.field=this.props.field,this.processing=!1,this.new_content="",this.showUserAnswers=!1},a.config=function(){var t=this;this.$(".js-answers-container").sortable({handle:".js-answer-handle"}).on("sortupdate",function(){var n=t.$(".js-answer-data").map(function(){return $(this).data("id")}).get();t.updateSort(n)})},a.view=function(){var t=this;if(!this.field.exists)return m("div",s.a.translator.trans("flagrow-mason.admin.fields.save-field-for-answers"));var n=[],a=[];return this.field.all_answers().forEach(function(t){void 0!==t&&(t.is_suggested()?n.push(t):a.push(t))}),m("div",[m(".Mason-Container.js-answers-container",Object(F.a)(n).map(function(t){return m(".js-answer-data",{key:t.id(),"data-id":t.id()},x.component({answer:t}))})),a.length?[m(".Button.Button--block.Mason-Box-Header",{onclick:function(){t.showUserAnswers=!t.showUserAnswers}},[m(".Mason-Box-Header-Title",s.a.translator.trans("flagrow-mason.admin.buttons.show-user-answers",{count:a.length})),m("div",[w()("fas fa-chevron-"+(this.showUserAnswers?"up":"down"))])]),this.showUserAnswers?m(".Mason-Container",Object(F.a)(a,"content").map(function(t){return m("div",{key:t.id()},x.component({answer:t}))})):null]:null,m("form",[m(".Form-group",[m("label","New answer"),m("input.FormControl",{value:this.new_content,oninput:m.withAttr("value",function(n){t.new_content=n}),placeholder:s.a.translator.trans("flagrow-mason.admin.fields.new-answer-placeholder")})]),m(".Form-group",[v.a.component({type:"submit",className:"Button Button--primary",children:s.a.translator.trans("flagrow-mason.admin.buttons.add-answer"),loading:this.processing,disabled:!this.new_content,onclick:this.saveField.bind(this)})])])])},a.saveField=function(){var t=this;this.processing=!0,s.a.request({method:"POST",url:s.a.forum.attribute("apiUrl")+this.field.apiEndpoint()+"/answers",data:{data:{attributes:{content:this.new_content,is_suggested:!0}}}}).then(function(n){s.a.store.pushPayload(n),t.new_content="",t.processing=!1,m.redraw()})},a.updateSort=function(t){s.a.request({method:"POST",url:s.a.forum.attribute("apiUrl")+this.field.apiEndpoint()+"/answers/order",data:{sort:t}}).then(function(t){s.a.store.pushPayload(t),m.redraw()})},n}(h.a),S=function(t){function n(){return t.apply(this,arguments)||this}Object(f.a)(n,t);var a=n.prototype;return a.init=function(){this.field=this.props.field,this.dirty=!1,this.processing=!1,this.toggleFields=!1,null===this.field&&this.initNewField()},a.initNewField=function(){this.field=s.a.store.createRecord("flagrow-mason-field",{attributes:{name:"",description:"",min_answers_count:0,max_answers_count:1,user_values_allowed:!1,show_when_empty:!1,validation:"",icon:""}})},a.boxTitle=function(){return this.field.exists?this.field.name():s.a.translator.trans("flagrow-mason.admin.buttons.new-field")},a.view=function(){var t=this;return m(".Mason-Box",[this.field.exists?m("span.fa.fa-arrows.Mason-Box--handle.js-field-handle"):null,m(".Button.Button--block.Mason-Box-Header",{onclick:function(){t.toggleFields=!t.toggleFields}},[m(".Mason-Box-Header-Title",this.boxTitle()),m("div",[this.field.exists?[s.a.translator.trans("flagrow-mason.admin.buttons.edit-field")," "]:null,w()("fas fa-chevron-"+(this.toggleFields?"up":"down"))])]),this.toggleFields?this.viewFields():null])},a.viewFields=function(){var t=this;return m("form",[m(".Mason-Box--row",[m(".Mason-Box--column",[m("h4","Field settings"),m(".Form-group",[m("label",s.a.translator.trans("flagrow-mason.admin.fields.name")),m("input.FormControl",{value:this.field.name(),oninput:m.withAttr("value",this.updateAttribute.bind(this,"name"))}),m(".helpText",s.a.translator.trans("flagrow-mason.admin.fields.name-help"))]),m(".Form-group",[m("label",s.a.translator.trans("flagrow-mason.admin.fields.description")),m("input.FormControl",{value:this.field.description(),oninput:m.withAttr("value",this.updateAttribute.bind(this,"description"))}),m(".helpText",s.a.translator.trans("flagrow-mason.admin.fields.description-help"))]),m(".Form-group",[m("label",[y.a.component({state:1===this.field.min_answers_count(),onchange:function(n){t.updateAttribute("min_answers_count",n?1:0)},children:s.a.translator.trans("flagrow-mason.admin.fields.required")})])]),m(".Form-group",[m("label",[y.a.component({state:this.field.show_when_empty(),onchange:this.updateAttribute.bind(this,"show_when_empty"),children:s.a.translator.trans("flagrow-mason.admin.fields.show_when_empty")})]),m(".helpText",s.a.translator.trans("flagrow-mason.admin.fields.show_when_empty-help"))]),m(".Form-group",[m("label",[y.a.component({state:this.field.user_values_allowed(),onchange:this.updateAttribute.bind(this,"user_values_allowed"),children:s.a.translator.trans("flagrow-mason.admin.fields.user_values_allowed")})]),m(".helpText",s.a.translator.trans("flagrow-mason.admin.fields.user_values_allowed-help"))]),m(".Form-group",[m("label",s.a.translator.trans("flagrow-mason.admin.fields.validation")),m("input.FormControl",{disabled:!this.field.user_values_allowed(),placeholder:this.field.user_values_allowed()?"":s.a.translator.trans("flagrow-mason.admin.fields.enable-user-values-for-validation"),value:this.field.validation(),oninput:m.withAttr("value",this.updateAttribute.bind(this,"validation"))}),m(".helpText",s.a.translator.trans("flagrow-mason.admin.fields.validation-help",{a:m("a[href=https://laravel.com/docs/5.1/validation#available-validation-rules][_target=blank]")}))]),m(".Form-group",[m("label",[s.a.translator.trans("flagrow-mason.admin.fields.icon"),this.iconPreview(this.field.icon())]),m("input.FormControl",{value:this.field.icon(),oninput:m.withAttr("value",this.updateAttribute.bind(this,"icon"))}),m(".helpText",s.a.translator.trans("flagrow-mason.admin.fields.icon-help",{a:m("a[href=https://fontawesome.com/icons?m=free][_target=blank]")}))])]),m(".Mason-Box--column",[m("h4","Field answers"),m(".Form-group",A.component({field:this.field}))])]),m("li.ButtonGroup",[v.a.component({type:"submit",className:"Button Button--primary",children:s.a.translator.trans("flagrow-mason.admin.buttons."+(this.field.exists?"save":"add")+"-field"),loading:this.processing,disabled:!this.readyToSave(),onclick:this.saveField.bind(this)}),this.field.exists?v.a.component({type:"submit",className:"Button Button--danger",children:s.a.translator.trans("flagrow-mason.admin.buttons.delete-field"),loading:this.processing,onclick:this.deleteField.bind(this)}):""])])},a.updateAttribute=function(t,n){var a;this.field.pushAttributes(((a={})[t]=n,a)),this.dirty=!0},a.readyToSave=function(){return this.dirty},a.saveField=function(){var t=this;this.processing=!0;var n=!this.field.exists;this.field.save(this.field.data.attributes).then(function(){n&&(t.initNewField(),t.toggleFields=!1),t.processing=!1,t.dirty=!1,m.redraw()}).catch(function(n){throw t.processing=!1,n})},a.deleteField=function(){var t=this;confirm(s.a.translator.trans("flagrow-mason.admin.messages.delete-field-confirmation",{name:this.field.name()}))&&(this.processing=!0,this.field.delete().then(function(){t.processing=!1,m.redraw()}).catch(function(n){throw t.processing=!1,n}))},a.iconPreview=function(t){return t?[" (",s.a.translator.trans("flagrow-mason.admin.fields.icon-preview",{preview:w()(t)}),")"]:""},n}(h.a),j=a(25),B=a.n(j),O=a(26),T=a.n(O),M=function(t){function n(){return t.apply(this,arguments)||this}Object(f.a)(n,t);var a=n.prototype;return a.init=function(){this.fieldsSectionTitle=m.prop(s.a.data.settings["flagrow.mason.fields-section-title"]||""),this.columnCount=m.prop(s.a.data.settings["flagrow.mason.column-count"]||1),this.labelsAsPlaceholders=m.prop(s.a.data.settings["flagrow.mason.labels-as-placeholders"]>0),this.fieldsInHero=m.prop(s.a.data.settings["flagrow.mason.fields-in-hero"]>0),this.hideEmptyFieldsSection=m.prop(s.a.data.settings["flagrow.mason.hide-empty-fields-section"]>0),this.tagsAsFields=m.prop(s.a.data.settings["flagrow.mason.tags-as-fields"]>0),this.tagsFieldName=m.prop(s.a.data.settings["flagrow.mason.tags-field-name"]||""),this.columnOptions={};for(var t=1;t<=3;t++)this.columnOptions[t]=s.a.translator.trans("flagrow-mason.admin.settings.n-columns",{count:t})},a.view=function(){return m(".Mason-Container",[m(".Form-group",[m("label",s.a.translator.trans("flagrow-mason.admin.settings.fields-section-title")),m("input.FormControl",{value:this.fieldsSectionTitle(),placeholder:s.a.translator.trans("flagrow-mason.admin.settings.fields-section-title-placeholder"),onchange:m.withAttr("value",this.updateSetting.bind(this,this.fieldsSectionTitle,"flagrow.mason.fields-section-title"))}),m(".helpText",s.a.translator.trans("flagrow-mason.admin.settings.fields-section-title-help"))]),m(".Form-group",[m("label",s.a.translator.trans("flagrow-mason.admin.settings.column-count")),T.a.component({options:this.columnOptions,value:this.columnCount(),onchange:this.updateSetting.bind(this,this.columnCount,"flagrow.mason.column-count")})]),m(".Form-group",[m("label",y.a.component({state:this.labelsAsPlaceholders(),onchange:this.updateSetting.bind(this,this.labelsAsPlaceholders,"flagrow.mason.labels-as-placeholders"),children:s.a.translator.trans("flagrow-mason.admin.settings.labels-as-placeholders")})),m(".helpText",s.a.translator.trans("flagrow-mason.admin.settings.labels-as-placeholders-help"))]),m(".Form-group",[m("label",y.a.component({state:this.fieldsInHero(),onchange:this.updateSetting.bind(this,this.fieldsInHero,"flagrow.mason.fields-in-hero"),children:s.a.translator.trans("flagrow-mason.admin.settings.fields-in-hero")}))]),m(".Form-group",[m("label",y.a.component({state:this.hideEmptyFieldsSection(),onchange:this.updateSetting.bind(this,this.hideEmptyFieldsSection,"flagrow.mason.hide-empty-fields-section"),children:s.a.translator.trans("flagrow-mason.admin.settings.hide-empty-fields-section")})),m(".helpText",s.a.translator.trans("flagrow-mason.admin.settings.hide-empty-fields-section-help"))]),m(".Form-group",[m("label",y.a.component({state:this.tagsAsFields(),onchange:this.updateSetting.bind(this,this.tagsAsFields,"flagrow.mason.tags-as-fields"),children:s.a.translator.trans("flagrow-mason.admin.settings.tags-as-field")})),m(".helpText",s.a.translator.trans("flagrow-mason.admin.settings.tags-as-field-help"))]),this.tagsAsFields()?m(".Form-group",[m("label",s.a.translator.trans("flagrow-mason.admin.settings.tags-field-name")),m("input.FormControl",{value:this.tagsFieldName(),placeholder:s.a.translator.trans("flagrow-mason.admin.settings.tags-field-name-placeholder"),onchange:m.withAttr("value",this.updateSetting.bind(this,this.tagsFieldName,"flagrow.mason.tags-field-name"))})]):null])},a.updateSetting=function(t,n,a){var e;B()(((e={})[n]=a,e)),t(a)},n}(h.a),k=function(t){function n(){return t.apply(this,arguments)||this}Object(f.a)(n,t);var a=n.prototype;return a.init=function(){s.a.request({method:"GET",url:s.a.forum.attribute("apiUrl")+"/flagrow/mason/fields"}).then(function(t){s.a.store.pushPayload(t),m.redraw()})},a.config=function(){var t=this;this.$(".js-fields-container").sortable({handle:".js-field-handle"}).on("sortupdate",function(){var n=t.$(".js-field-data").map(function(){return $(this).data("id")}).get();t.updateSort(n)})},a.view=function(){var t=s.a.store.all("flagrow-mason-field"),n=[];return Object(F.a)(t).forEach(function(t){n.push(m(".js-field-data",{key:t.id(),"data-id":t.id()},S.component({field:t})))}),m(".container",[m("h2",s.a.translator.trans("flagrow-mason.admin.titles.fields")),m(".Mason-Container",[m(".js-fields-container",n),S.component({key:"new",field:null})]),m("h2",s.a.translator.trans("flagrow-mason.admin.titles.settings")),M.component()])},a.updateSort=function(t){s.a.request({method:"POST",url:s.a.forum.attribute("apiUrl")+"/flagrow/mason/fields/order",data:{sort:t}}).then(function(t){s.a.store.pushPayload(t),m.redraw()})},n}(h.a),P=a(10),C=a.n(P),N=a(27),E=a.n(N);s.a.initializers.add("flagrow-mason",function(t){t.store.models["flagrow-mason-field"]=i.a,t.store.models["flagrow-mason-answer"]=o.a,s.a.routes["flagrow-mason-fields"]={path:"/flagrow/mason",component:k.component()},s.a.extensionSettings["flagrow-mason"]=function(){return m.route(s.a.route("flagrow-mason-fields"))},Object(r.extend)(d.a.prototype,"items",function(t){t.add("flagrow-mason-fields",c.a.component({href:s.a.route("flagrow-mason-fields"),icon:"fas fa-dungeon",children:"Mason",description:s.a.translator.trans("flagrow-mason.admin.menu.description")}))}),Object(r.extend)(E.a.prototype,"permissionItems",function(t){var n=new C.a;n.add("see-own-fields",{icon:"fas fa-eye",label:s.a.translator.trans("flagrow-mason.admin.permissions.see-own-fields"),permission:"flagrow.mason.see-own-fields"}),n.add("see-other-fields",{icon:"fas fa-eye",label:s.a.translator.trans("flagrow-mason.admin.permissions.see-other-fields"),permission:"flagrow.mason.see-other-fields",allowGuest:!0}),n.add("fill-fields",{icon:"fas fa-tasks",label:s.a.translator.trans("flagrow-mason.admin.permissions.fill-fields"),permission:"flagrow.mason.fill-fields"}),n.add("update-own-fields",{icon:"fas fa-edit",label:s.a.translator.trans("flagrow-mason.admin.permissions.update-own-fields"),permission:"flagrow.mason.update-own-fields"}),n.add("update-other-fields",{icon:"fas fa-edit",label:s.a.translator.trans("flagrow-mason.admin.permissions.update-other-fields"),permission:"flagrow.mason.update-other-fields",allowGuest:!0}),n.add("skip-required-fields",{icon:"fas fa-forward",label:s.a.translator.trans("flagrow-mason.admin.permissions.skip-required-fields"),permission:"flagrow.mason.skip-required-fields"}),t.add("flagrow-mason",{label:s.a.translator.trans("flagrow-mason.admin.permissions.mason-heading"),children:n.toArray()})})})}]);
//# sourceMappingURL=admin.js.map