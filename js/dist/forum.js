module.exports=function(t){var n={};function e(s){if(n[s])return n[s].exports;var a=n[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=n,e.d=function(t,n,s){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(s,a,function(n){return t[n]}.bind(null,a));return s},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=29)}([,function(t,n){t.exports=flarum.core.compat["forum/app"]},function(t,n){t.exports=flarum.core.compat["common/Model"]},function(t,n,e){"use strict";function s(t,n){return(s=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function a(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n)}e.d(n,"a",(function(){return a}))},function(t,n){t.exports=flarum.core.compat["common/Component"]},function(t,n){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,n){t.exports=flarum.core.compat["common/components/Button"]},function(t,n,e){"use strict";function s(t,n){return n||(n="sort"),t.sort((function(t,e){return t[n]()-e[n]()}))}e.d(n,"a",(function(){return s}))},function(t,n){t.exports=flarum.core.compat["common/extend"]},,function(t,n,e){"use strict";e.d(n,"a",(function(){return r}));var s=e(3),a=e(2),o=e.n(a),r=function(t){function n(){for(var n,e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return(n=t.call.apply(t,[this].concat(s))||this).content=o.a.attribute("content"),n.is_suggested=o.a.attribute("is_suggested"),n.sort=o.a.attribute("sort"),n.field=o.a.hasOne("field"),n}return Object(s.a)(n,t),n.prototype.apiEndpoint=function(){return"/fof/mason/answers"+(this.exists?"/"+this.data.id:"")},n}(o.a)},function(t,n){t.exports=flarum.core.compat["common/utils/computed"]},function(t,n){t.exports=flarum.core.compat["common/utils/ItemList"]},,function(t,n,e){"use strict";e.d(n,"a",(function(){return c}));var s=e(3),a=e(2),o=e.n(a),r=e(11),i=e.n(r),c=function(t){function n(){for(var n,e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return(n=t.call.apply(t,[this].concat(s))||this).name=o.a.attribute("name"),n.description=o.a.attribute("description"),n.min_answers_count=o.a.attribute("min_answers_count"),n.max_answers_count=o.a.attribute("max_answers_count"),n.show_when_empty=o.a.attribute("show_when_empty"),n.user_values_allowed=o.a.attribute("user_values_allowed"),n.validation=o.a.attribute("validation"),n.icon=o.a.attribute("icon"),n.sort=o.a.attribute("sort"),n.deleted_at=o.a.attribute("deleted_at",o.a.transformDate),n.all_answers=o.a.hasMany("all_answers"),n.suggested_answers=o.a.hasMany("suggested_answers"),n.required=i()("min_answers_count",(function(t){return t>0})),n.multiple=i()("max_answers_count",(function(t){return t>1})),n}return Object(s.a)(n,t),n.prototype.apiEndpoint=function(){return"/fof/mason/fields"+(this.exists?"/"+this.data.id:"")},n}(o.a)},function(t,n){t.exports=flarum.core.compat["common/utils/classList"]},,function(t,n){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,n){t.exports=flarum.core.compat["common/components/DiscussionComposer"]},function(t,n){t.exports=flarum.core.compat["common/components/CommentPost"]},function(t,n){t.exports=flarum.core.compat["common/models/Forum"]},function(t,n){t.exports=flarum.core.compat["tags/utils/sortTags"]},function(t,n){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,n){t.exports=flarum.core.compat["common/components/Modal"]},function(t,n){t.exports=flarum.core.compat["common/components/DiscussionHero"]},function(t,n){t.exports=flarum.core.compat["common/components/DiscussionPage"]},,,,function(t,n,e){"use strict";e.r(n);var s=e(1),a=e.n(s),o=e(2),r=e.n(o),i=e(17),c=e.n(i),u=e(20),l=e.n(u),f=e(10),d=e(14),h=e(8),p=e(18),g=e.n(p),b=e(3),v=e(5),w=e.n(v),y=e(12),x=e.n(y),M=e(4),_=e.n(M),A=e(15),O=e.n(A),j=e(7);function S(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return F(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return F(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function F(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,s=new Array(n);e<n;e++)s[e]=t[e];return s}var N=function(t){function n(){return t.apply(this,arguments)||this}Object(b.a)(n,t);var e=n.prototype;return e.view=function(t){var n=t.attrs,e=n.field,s=n.answers,o=n.onchange,r=[];return e.suggested_answers().forEach((function(t){-1!==s.findIndex((function(n){return void 0!==n&&n.id()===t.id()}))&&r.push(t.id())})),m("span",{className:"Select"},m("select",{className:"Select-input FormControl",multiple:e.multiple(),onchange:function(t){for(var n,e=[],s=S(t.target.options);!(n=s()).done;){var r=n.value;if(r.selected&&"none"!==r.value){var i=r.value;e.push(a.a.store.getById("mason-answers",i))}}o(e)}},!e.multiple()&&m("option",{value:"none",selected:0===r.length,disabled:e.required(),hidden:this.placeholderHidden(e)},this.selectPlaceholder(e)),Object(j.a)(e.suggested_answers()).map((function(t){return m("option",{value:t.id(),selected:-1!==r.indexOf(t.id())},t.content())}))),w()("fas fa-caret-down",{className:"Select-caret"}))},e.placeholderHidden=function(t){return!a.a.forum.attribute("fof-mason.labels-as-placeholders")&&t.required()},e.selectPlaceholder=function(t){var n="";return a.a.forum.attribute("fof-mason.labels-as-placeholders")&&(n+=t.name(),t.required()&&(n+=" *"),n+=" - "),t.required()?n+=a.a.translator.trans("fof-mason.forum.answers.choose-option"):n+=a.a.translator.trans("fof-mason.forum.answers.no-option-selected"),n},n}(_.a),I=function(t){function n(){return t.apply(this,arguments)||this}Object(b.a)(n,t);var e=n.prototype;return e.oninit=function(n){var e=this;t.prototype.oninit.call(this,n),this.field=this.attrs.field,this.answers=this.attrs.answers,this.onchange=this.attrs.onchange,this.content="";var s=this.answers.filter((function(t){return void 0!==t&&t.field().id()===e.field.id()}));s.length&&(this.content=s[0].content())},e.view=function(){var t=this;return m("input",{className:"FormControl",required:this.field.required(),value:this.content,oninput:function(n){if(t.content=n.target.value,""===t.content)t.onchange([]);else{var e=a.a.store.createRecord("mason-answers",{attributes:{content:t.content},relationships:{field:{data:r.a.getIdentifier(t.field)}}});t.onchange([e])}},placeholder:this.fieldPlaceholder()})},e.fieldPlaceholder=function(){return a.a.forum.attribute("fof-mason.labels-as-placeholders")?this.field.name()+(this.field.required()?" *":""):""},n}(_.a),P=e(21),T=e.n(P),q=function(t){function n(){for(var n,e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return(n=t.call.apply(t,[this].concat(s))||this).inputUuid=void 0,n}Object(b.a)(n,t);var e=n.prototype;return e.oninit=function(n){var e=this;t.prototype.oninit.call(this,n),this.tags=a.a.store.all("tags"),this.selectedTags=[],this.attrs.discussion?(this.tags=this.tags.filter((function(t){return t.canAddToDiscussion()||-1!==e.attrs.discussion.tags().indexOf(t)})),this.selectedTags=this.attrs.discussion.tags()):this.tags=this.tags.filter((function(t){return t.canStartDiscussion()})),this.minPrimary=a.a.forum.attribute("minPrimaryTags"),this.maxPrimary=a.a.forum.attribute("maxPrimaryTags"),this.minSecondary=a.a.forum.attribute("minSecondaryTags"),this.maxSecondary=a.a.forum.attribute("maxSecondaryTags"),this.maxPrimary<=0&&(this.tags=this.tags.filter((function(t){return!t.isPrimary()}))),this.maxSecondary<=0&&(this.tags=this.tags.filter((function(t){return t.isPrimary()}))),this.tags=T()(this.tags),this.inputUuid=Math.random().toString(36).substring(2)},e.view=function(){var t,n=this;if(this.maxPrimary>1||this.maxSecondary>1)return m("div",{className:"Alert"},a.a.translator.trans("fof-mason.forum.tags.inadequate-settings"));var e=this.selectedTags.length?this.selectedTags.sort((function(t){return t.parent()?-1:1}))[0].id():null,s=this.fieldRequired();return m("div",{className:O()("Mason-Field Form-group",(t={},t["Mason-Field--label-as-placeholder"]=a.a.forum.attribute("fof-mason.labels-as-placeholders"),t))},m("label",{for:"fofMason-selectInput-"+inputUuid},this.fieldLabel()),m("span",{className:"Select"},m("select",{className:"Select-input FormControl",id:"fofMason-selectInput-"+inputUuid,onchange:function(t){var e=t.target.value;if(n.selectedTags=[],"none"!==e){n.selectedTags.push(n.tags.find((function(t){return t.id()===e})));var s=n.selectedTags[0].parent();s&&n.selectedTags.push(s)}n.attrs.onchange(n.selectedTags)}},m("option",{value:"none",selected:0===this.selectedTags.length,disabled:s,hidden:this.placeholderHidden()},this.selectPlaceholder()),this.tags.map((function(t){var n=t.parent();return m("option",{value:t.id(),selected:t.id()===e},(n?n.name()+" | ":"")+t.name())})),","),w()("fas fa-caret-down",{className:"Select-caret"})))},e.fieldRequired=function(){return this.minPrimary>0||this.minSecondary>0},e.fieldLabel=function(){var t=a.a.forum.attribute("fof-mason.tags-field-name")||a.a.translator.trans("fof-mason.forum.tags.tags-label");return this.fieldRequired()&&(t+=" *"),t},e.placeholderHidden=function(){return!a.a.forum.attribute("fof-mason.labels-as-placeholders")&&this.fieldRequired()},e.selectPlaceholder=function(){var t="";return a.a.forum.attribute("fof-mason.labels-as-placeholders")&&(t+=this.fieldLabel()+" - "),this.fieldRequired()?t+=a.a.translator.trans("fof-mason.forum.answers.choose-option"):t+=a.a.translator.trans("fof-mason.forum.answers.no-option-selected"),t},n}(_.a);var C=function(t){function n(){return t.apply(this,arguments)||this}return Object(b.a)(n,t),n.prototype.view=function(){return m("div",{className:"Mason-Grid-Wrapper"},m("div",{className:"Mason-Grid"},(t=this.attrs.items,n=a.a.forum.attribute("fof-mason.column-count"),Array(Math.ceil(t.length/n)).fill(void 0).map((function(e,s){return t.slice(n*s,n+n*s)}))).map((function(t){return m("div",{className:"Mason-Row"},t.map((function(t){return m("div",Object.assign({className:"Mason-Column"},t))})))}))));var t,n},n}(_.a),U=function(t){function n(){return t.apply(this,arguments)||this}Object(b.a)(n,t);var e=n.prototype;return e.oninit=function(n){var e=this;t.prototype.oninit.call(this,n),this.fields=Object(j.a)(a.a.store.all("mason-fields")),this.answerToFieldIndex=[],this.fields.forEach((function(t){t.suggested_answers().forEach((function(n){e.answerToFieldIndex[n.id()]=t.id()}))}))},e.view=function(){return m("div",{className:"Mason-Fields Mason-Fields--editor"},this.headItems().toArray(),m(C,{items:this.fieldItems().toArray()}))},e.updateSelection=function(t,n){var e=this,s=this.attrs.answers.filter((function(n){var s=e.answerToFieldIndex[n.id()];return void 0===s?n.field().id()!==t.id():s!==t.id()}));s=s.concat(n),this.attrs.onchange(s)},e.headItems=function(){var t=new x.a;return a.a.forum.attribute("fof-mason.fields-section-title")&&t.add("title",m("h5",{className:"Mason-Field--title"},a.a.forum.attribute("fof-mason.fields-section-title"))),t},e.fieldItems=function(){var t=this,n=new x.a;return a.a.forum.attribute("fof-mason.tags-as-fields")&&n.add("tags",m(q,{discussion:this.attrs.discussion,onchange:function(n){t.attrs.ontagchange&&t.attrs.ontagchange(n)}})),this.fields.forEach((function(e){var s,o={field:e,answers:t.attrs.answers,onchange:function(n){t.updateSelection(e,n)}},r=null;r=e.user_values_allowed()?m(I,o):m(N,o),n.add("field-"+e.id(),m("div",{class:O()("Mason-Field Form-group",(s={},s["Mason-Field--label-as-placeholder"]=a.a.forum.attribute("fof-mason.labels-as-placeholders"),s))},m("label",null,e.icon()?m("[",null,w()(e.icon())," "):null,e.name(),e.required()?" *":null),r,e.description()?m("div",{className:"helpText"},e.description()):null))})),n},n}(_.a),D=e(22),E=e.n(D),R=e(6),B=e.n(R),H=e(23),L=function(t){function n(){return t.apply(this,arguments)||this}Object(b.a)(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.answers=this.attrs.discussion.masonAnswers(),this.dirty=!1,this.processing=!1,this.tags=null},e.title=function(){return a.a.translator.trans("fof-mason.forum.answers-modal.edit-title",{title:m("em",null,"this.attrs.discussion.title()")})},e.content=function(){var t=this;return m("[",null,m("div",{className:"Modal-body"},m(U,{discussion:this.attrs.discussion,answers:this.answers,onchange:this.answersChanged.bind(this),ontagchange:function(n){t.tags=n,t.dirty=!0}})),m("div",{className:"Modal-footer"},m(B.a,{className:"Button Button--primary",loading:this.processing,disabled:!this.dirty,onclick:this.saveAnswers.bind(this)},a.a.translator.trans("fof-mason.forum.answers-modal.save"))))},e.answersChanged=function(t){this.answers=t,this.dirty=!0},e.saveAnswers=function(){var t=this;this.processing=!0;var n={masonAnswers:this.answers};null!==this.tags&&(n.tags=this.tags),this.attrs.discussion.save({relationships:n}).then((function(){t.processing=!1,a.a.modal.close(),m.redraw()})).catch((function(n){throw t.processing=!1,n}))},n}(e.n(H).a),k=e(24),G=e.n(k),z=function(t){function n(){return t.apply(this,arguments)||this}Object(b.a)(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.fields=Object(j.a)(a.a.store.all("mason-fields")),this.discussion=this.attrs.discussion},e.view=function(){var t=this.headItems().toArray(),n=this.fieldsItems().toArray();return n.length||t.length&&!a.a.forum.attribute("fof-mason.hide-empty-fields-section")?m("div",{className:"Mason-Fields Mason-Fields--viewer"},t,m(C,{items:n})):m("div",null)},e.headItems=function(){var t=this,n=new x.a;return this.discussion.canUpdateMasonAnswers()&&n.add("edit",m(B.a,{className:"Button Mason-Fields--edit",icon:"fas fa-pen",onclick:function(){return a.a.modal.show(L,{discussion:t.discussion})}},a.a.translator.trans("fof-mason.forum.discussion-controls.edit-answers"))),a.a.forum.attribute("fof-mason.fields-section-title")&&n.add("title",m("h5",{className:"Mason-Field--title"},a.a.forum.attribute("fof-mason.fields-section-title"))),n},e.fieldsItems=function(){var t=this,n=new x.a;return this.fields.forEach((function(e){var s=Object(j.a)((t.discussion.masonAnswers()||[]).filter((function(t){return t.field()&&t.field().id()===e.id()}))),o=s.map((function(t){return m("span",{className:"Mason-Inline-Answer"},t.content())}));if(0===s.length){if(!e.show_when_empty())return;o.push(m("em",{className:"Mason-Inline-Answer"},a.a.translator.trans("fof-mason.forum.post-answers.no-answer")))}n.add("field-"+e.id(),m("div",{className:"Mason-Field Form-group"},m("label",null,e.icon()?m("[",null,w()(e.icon())," "):null,e.name()),",",m("div",{className:"FormControl Mason-Inline-Answers"},o),","))})),n},n}(_.a),J=e(19),W=e.n(J),$=e(25),K=e.n($);function Q(t){return!!a.a.current.matches(K.a)&&(1===t.number()&&!a.a.forum.attribute("fof-mason.fields-in-hero"))}a.a.initializers.add("fof-mason",(function(t){t.store.models["mason-fields"]=d.a,t.store.models["mason-answers"]=f.a,c.a.prototype.masonAnswers=r.a.hasMany("masonAnswers"),c.a.prototype.canSeeMasonAnswers=r.a.attribute("canSeeMasonAnswers"),c.a.prototype.canUpdateMasonAnswers=r.a.attribute("canUpdateMasonAnswers"),l.a.prototype.canFillMasonFields=r.a.attribute("canFillMasonFields"),g.a.prototype.masonAnswers=[],Object(h.extend)(g.a.prototype,"headerItems",(function(t){var n=this;a.a.forum.canFillMasonFields()&&t.add("mason-fields",m(U,{answers:this.masonAnswers,onchange:function(t){n.masonAnswers=t},ontagchange:function(t){n.composer.fields.tags=t}}))})),Object(h.extend)(g.a.prototype,"data",(function(t){a.a.forum.canFillMasonFields()&&(t.relationships=t.relationships||{},t.relationships.masonAnswers=this.masonAnswers)})),Object(h.extend)(G.a.prototype,"items",(function(t){this.attrs.discussion.canSeeMasonAnswers()&&a.a.forum.attribute("fof-mason.fields-in-hero")&&t.add("mason-fields",m(z,{discussion:this.attrs.discussion}))})),Object(h.extend)(W.a.prototype,"oninit",(function(){var t=this;this.attrs.post.discussion().canSeeMasonAnswers()&&Q(this.attrs.post)&&this.subtree.check((function(){return(t.attrs.post.discussion().masonAnswers()||[]).map((function(t){return t?JSON.stringify([t.id(),!!t.field()]):""})).join(",")}))})),Object(h.extend)(W.a.prototype,"content",(function(t){if(this.attrs.post.discussion().canSeeMasonAnswers()&&Q(this.attrs.post)){var n=t.findIndex((function(t){return t.attrs&&"Post-header"===t.attrs.className}));t.splice(-1===n?0:n+1,0,m(z,{discussion:this.attrs.post.discussion()}))}})),Object(h.extend)(E.a,"moderationControls",(function(t,n){n.canUpdateMasonAnswers()&&t.add("mason-update-answers",m(B.a,{icon:"fas fa-tag",onclick:function(){return a.a.modal.show(L,{discussion:n})}},a.a.translator.trans("fof-mason.forum.discussion-controls.edit-answers")))})),Object(h.override)(r.a,"getIdentifier",(function(t,n){return n instanceof f.a&&!n.exists?{type:n.data.type,attributes:{content:n.data.attributes.content},relationships:{field:{data:r.a.getIdentifier(n.data.relationships.field)}}}:t(n)}))}))}]);
//# sourceMappingURL=forum.js.map