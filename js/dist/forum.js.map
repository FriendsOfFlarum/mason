{"version":3,"sources":["webpack://@fof/mason/webpack/bootstrap","webpack://@fof/mason/external \"flarum.core.compat['app']\"","webpack://@fof/mason/external \"flarum.core.compat['Model']\"","webpack://@fof/mason/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/mason/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/mason/external \"flarum.core.compat['Component']\"","webpack://@fof/mason/external \"flarum.core.compat['helpers/icon']\"","webpack://@fof/mason/external \"flarum.core.compat['components/Button']\"","webpack://@fof/mason/./src/lib/helpers/sortByAttribute.js","webpack://@fof/mason/external \"flarum.core.compat['extend']\"","webpack://@fof/mason/./src/lib/models/Answer.js","webpack://@fof/mason/external \"flarum.core.compat['utils/computed']\"","webpack://@fof/mason/external \"flarum.core.compat['utils/ItemList']\"","webpack://@fof/mason/./src/lib/models/Field.js","webpack://@fof/mason/external \"flarum.core.compat['models/Discussion']\"","webpack://@fof/mason/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@fof/mason/external \"flarum.core.compat['components/CommentPost']\"","webpack://@fof/mason/external \"flarum.core.compat['models/Forum']\"","webpack://@fof/mason/external \"flarum.core.compat['tags/utils/sortTags']\"","webpack://@fof/mason/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@fof/mason/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/mason/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@fof/mason/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@fof/mason/./src/forum/components/FieldEditDropdown.js","webpack://@fof/mason/./src/forum/components/FieldEditText.js","webpack://@fof/mason/./src/forum/components/FieldEditTags.js","webpack://@fof/mason/./src/forum/components/FieldGrid.js","webpack://@fof/mason/./src/forum/helpers/chunkArray.js","webpack://@fof/mason/./src/forum/components/FieldsEditor.js","webpack://@fof/mason/./src/forum/components/FieldsEditorModal.js","webpack://@fof/mason/./src/forum/components/FieldsViewer.js","webpack://@fof/mason/./src/forum/addFieldsOnDiscussionPost.js","webpack://@fof/mason/./src/forum/index.js","webpack://@fof/mason/./src/forum/addComposerFields.js","webpack://@fof/mason/./src/forum/addFieldsOnDiscussionHero.js","webpack://@fof/mason/./src/forum/addFieldUpdateControl.js","webpack://@fof/mason/./src/forum/patchModelIdentifier.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","constructor","items","attr","sort","a","b","Answer","content","Model","attribute","is_suggested","field","hasOne","apiEndpoint","this","exists","data","id","Field","description","min_answers_count","max_answers_count","show_when_empty","user_values_allowed","validation","icon","deleted_at","transformDate","all_answers","hasMany","suggested_answers","required","computed","multiple","FieldEditDropdown","view","vnode","attrs","answers","onchange","selectedAnswerIdsForThisField","forEach","answer","findIndex","push","event","target","options","option","selected","answerId","app","store","getById","length","disabled","hidden","placeholderHidden","selectPlaceholder","sortByAttribute","map","indexOf","className","forum","text","translator","trans","Component","FieldEditText","oninit","answersForThisField","filter","oninput","createRecord","attributes","relationships","getIdentifier","placeholder","fieldPlaceholder","DiscussionFields","tags","all","selectedTags","discussion","tag","canAddToDiscussion","canStartDiscussion","minPrimary","maxPrimary","minSecondary","maxSecondary","isPrimary","sortTags","currentSelectedChild","parent","fieldRequired","fieldLabel","find","FieldGrid","itemsPerChunk","R","slice","chunkArray","row","item","FieldsEditor","fields","answerToFieldIndex","headItems","toArray","component","fieldItems","updateSelection","fieldAnswers","reverseFieldLookup","concat","ItemList","add","FieldEditTags","ontagchange","inputAttrs","input","FieldsEditorModal","masonAnswers","dirty","processing","title","answersChanged","Button","loading","onclick","saveAnswers","save","then","modal","close","redraw","err","Modal","FieldsViewer","head","fieldsItems","canUpdateMasonAnswers","show","answer_list","showFieldsOnPost","post","current","matches","DiscussionPage","number","initializers","models","Discussion","canSeeMasonAnswers","Forum","canFillMasonFields","DiscussionComposer","extend","composer","DiscussionHero","CommentPost","subtree","check","JSON","stringify","join","postHeaderIndex","splice","DiscussionControls","override","original","model","type"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 26);\n","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['Model'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['components/Button'];","export default function (items, attr = 'sort') {\n    return items.sort(\n        (a, b) => a[attr]() - b[attr]()\n    );\n}\n","module.exports = flarum.core.compat['extend'];","import Model from 'flarum/Model';\n\nexport default class Answer extends Model {\n    content = Model.attribute('content');\n    is_suggested = Model.attribute('is_suggested');\n    sort = Model.attribute('sort');\n    field = Model.hasOne('field');\n\n    apiEndpoint() {\n        return '/fof/mason/answers' + (this.exists ? '/' + this.data.id : '');\n    }\n}\n","module.exports = flarum.core.compat['utils/computed'];","module.exports = flarum.core.compat['utils/ItemList'];","import Model from 'flarum/Model';\nimport computed from 'flarum/utils/computed';\n\nexport default class Field extends Model {\n    name = Model.attribute('name');\n    description = Model.attribute('description');\n    min_answers_count = Model.attribute('min_answers_count');\n    max_answers_count = Model.attribute('max_answers_count');\n    show_when_empty = Model.attribute('show_when_empty');\n    user_values_allowed = Model.attribute('user_values_allowed');\n    validation = Model.attribute('validation');\n    icon = Model.attribute('icon');\n    sort = Model.attribute('sort');\n    deleted_at = Model.attribute('deleted_at', Model.transformDate);\n    all_answers = Model.hasMany('all_answers');\n    suggested_answers = Model.hasMany('suggested_answers');\n    required = computed('min_answers_count', min_answers_count => min_answers_count > 0);\n    multiple = computed('max_answers_count', max_answers_count => max_answers_count > 1);\n\n    apiEndpoint() {\n        return '/fof/mason/fields' + (this.exists ? '/' + this.data.id : '');\n    }\n}\n","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['components/CommentPost'];","module.exports = flarum.core.compat['models/Forum'];","module.exports = flarum.core.compat['tags/utils/sortTags'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/DiscussionHero'];","module.exports = flarum.core.compat['components/DiscussionPage'];","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport Component from 'flarum/Component';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\n\n/* global m */\n\nexport default class FieldEditDropdown extends Component {\n    view(vnode) {\n        // To be certain to not work on object copies, we always read the current one from vnode.attrs\n        const {field, answers, onchange} = vnode.attrs;\n\n        let selectedAnswerIdsForThisField = [];\n\n        field.suggested_answers().forEach(answer => {\n            const answerIndex = answers.findIndex(a => {\n                // Temporary store entries seem to turn into undefined after saving\n                if (typeof a === 'undefined') {\n                    return false;\n                }\n\n                return a.id() === answer.id();\n            });\n\n            if (answerIndex !== -1) {\n                selectedAnswerIdsForThisField.push(answer.id());\n            }\n        });\n\n        return m('span.Select', [\n            m('select.Select-input.FormControl', {\n                multiple: field.multiple(),\n                onchange: event => {\n                    let answers = [];\n\n                    for (let option of event.target.options) {\n                        if (option.selected && option.value !== 'none') {\n                            const answerId = option.value;\n\n                            // This will only work with suggested answers for now\n                            // As they are the only ones registered in the store\n                            answers.push(app.store.getById('mason-answers', answerId));\n                        }\n                    }\n\n                    onchange(answers);\n                },\n            }, [\n                (field.multiple() ? null : m('option', {\n                    value: 'none',\n                    selected: selectedAnswerIdsForThisField.length === 0,\n                    disabled: field.required(),\n                    hidden: this.placeholderHidden(field),\n                }, this.selectPlaceholder(field))),\n                sortByAttribute(field.suggested_answers()).map(\n                    answer => m('option', {\n                        value: answer.id(),\n                        selected: selectedAnswerIdsForThisField.indexOf(answer.id()) !== -1,\n                    }, answer.content())\n                ),\n            ]),\n            icon('fas fa-caret-down', {className: 'Select-caret'}),\n        ]);\n    }\n\n    placeholderHidden(field) {\n        // If labels are hidden, we need to always show the default value (even if it can't be selected)\n        // Otherwise when the field is \"required\" you can't find the name of the field anymore once something is selected\n        if (app.forum.attribute('fof-mason.labels-as-placeholders')) {\n            return false;\n        }\n\n        return field.required();\n    }\n\n    selectPlaceholder(field) {\n        let text = '';\n\n        if (app.forum.attribute('fof-mason.labels-as-placeholders')) {\n            text += field.name();\n\n            if (field.required()) {\n                text += ' *';\n            }\n\n            text += ' - ';\n        }\n\n        if (field.required()) {\n            text += app.translator.trans('fof-mason.forum.answers.choose-option');\n        } else {\n            text += app.translator.trans('fof-mason.forum.answers.no-option-selected');\n        }\n\n        return text;\n    }\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport Component from 'flarum/Component';\n\n/* global m */\n\nexport default class FieldEditText extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.field = this.attrs.field;\n        this.answers = this.attrs.answers;\n        this.onchange = this.attrs.onchange;\n\n        this.content = '';\n\n        const answersForThisField = this.answers.filter(answer => {\n            // Temporary store entries seem to turn into undefined after saving\n            if (typeof answer === 'undefined') {\n                return false;\n            }\n\n            return answer.field().id() === this.field.id();\n        });\n\n        if (answersForThisField.length) {\n            // For now we only support a single custom answer\n            this.content = answersForThisField[0].content();\n        }\n    }\n\n    view() {\n        return m('input.FormControl', {\n            required: this.field.required(),\n            value: this.content,\n            oninput: event => {\n                this.content = event.target.value;\n\n                if (this.content === '') {\n                    this.onchange([]);\n                } else {\n                    const answer = app.store.createRecord('mason-answers', {\n                        attributes: {\n                            content: this.content,\n                        },\n                        relationships: {\n                            field: {\n                                data: Model.getIdentifier(this.field),\n                            },\n                        },\n                    });\n\n                    this.onchange([answer]);\n                }\n            },\n            placeholder: this.fieldPlaceholder(),\n        });\n    }\n\n    fieldPlaceholder() {\n        if (app.forum.attribute('fof-mason.labels-as-placeholders')) {\n            return this.field.name() + (this.field.required() ? ' *' : '');\n        }\n\n        return '';\n    }\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport Component from 'flarum/Component';\nimport sortTags from 'flarum/tags/utils/sortTags';\n\n/* global m */\n\nexport default class DiscussionFields extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.tags = app.store.all('tags');\n        this.selectedTags = [];\n\n        if (this.attrs.discussion) {\n            this.tags = this.tags.filter(tag => tag.canAddToDiscussion() || this.attrs.discussion.tags().indexOf(tag) !== -1);\n\n            this.selectedTags = this.attrs.discussion.tags();\n        } else {\n            this.tags = this.tags.filter(tag => tag.canStartDiscussion());\n        }\n\n        this.minPrimary = app.forum.attribute('minPrimaryTags');\n        this.maxPrimary = app.forum.attribute('maxPrimaryTags');\n        this.minSecondary = app.forum.attribute('minSecondaryTags');\n        this.maxSecondary = app.forum.attribute('maxSecondaryTags');\n\n        // If primary tags are disabled, don't offer them\n        if (this.maxPrimary <= 0) {\n            this.tags = this.tags.filter(tag => !tag.isPrimary());\n        }\n\n        // If secondary tags are disabled, don't offer them\n        if (this.maxSecondary <= 0) {\n            this.tags = this.tags.filter(tag => tag.isPrimary());\n        }\n\n        this.tags = sortTags(this.tags);\n    }\n\n    view() {\n        if (this.maxPrimary > 1 || this.maxSecondary > 1) {\n            return m('.Alert', app.translator.trans('fof-mason.forum.tags.inadequate-settings'));\n        }\n\n        // We take the first child selected or if none, the first parent selected\n        // Of course this only works if a single tag or tag+parent is selected\n        // Multiple tags are not supported on this selector\n        const currentSelectedChild = this.selectedTags.length ? this.selectedTags.sort(tag => tag.parent() ? -1 : 1)[0].id() : null;\n\n        const required = this.fieldRequired();\n\n        return m('.Mason-Field.Form-group', {\n            className: app.forum.attribute('fof-mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\n        }, [\n            m('label', this.fieldLabel()),\n            m('span.Select', [\n                m('select.Select-input.FormControl', {\n                    onchange: event => {\n                        const id = event.target.value;\n\n                        this.selectedTags = [];\n\n                        if (id !== 'none') {\n                            this.selectedTags.push(this.tags.find(tag => tag.id() === id));\n\n                            const parent = this.selectedTags[0].parent();\n                            if (parent) {\n                                this.selectedTags.push(parent);\n                            }\n                        }\n\n                        this.attrs.onchange(this.selectedTags);\n                    },\n                }, [\n                    m('option', {\n                        value: 'none',\n                        selected: this.selectedTags.length === 0,\n                        disabled: required,\n                        hidden: this.placeholderHidden(),\n                    }, this.selectPlaceholder()),\n                    this.tags.map(\n                        tag => {\n                            const parent = tag.parent();\n\n                            return m('option', {\n                                value: tag.id(),\n                                selected: tag.id() === currentSelectedChild,\n                            }, (parent ? parent.name() + ' | ' : '') + tag.name());\n                        }\n                    ),\n                ]),\n                icon('fas fa-caret-down', {className: 'Select-caret'}),\n            ]),\n        ]);\n    }\n\n    fieldRequired() {\n        return this.minPrimary > 0 || this.minSecondary > 0;\n    }\n\n    fieldLabel() {\n        let text = app.forum.attribute('fof-mason.tags-field-name') || app.translator.trans('fof-mason.forum.tags.tags-label');\n\n        if (this.fieldRequired()) {\n            text += ' *';\n        }\n\n        return text;\n    }\n\n    placeholderHidden() {\n        if (app.forum.attribute('fof-mason.labels-as-placeholders')) {\n            return false;\n        }\n\n        return this.fieldRequired();\n    }\n\n    selectPlaceholder() {\n        let text = '';\n\n        if (app.forum.attribute('fof-mason.labels-as-placeholders')) {\n            text += this.fieldLabel() + ' - ';\n        }\n\n        if (this.fieldRequired()) {\n            text += app.translator.trans('fof-mason.forum.answers.choose-option');\n        } else {\n            text += app.translator.trans('fof-mason.forum.answers.no-option-selected');\n        }\n\n        return text;\n    }\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport chunkArray from './../helpers/chunkArray';\n\n/* global m */\n\nexport default class FieldGrid extends Component {\n    view() {\n        return m('.Mason-Grid-Wrapper', m('.Mason-Grid', chunkArray(this.attrs.items, app.forum.attribute('fof-mason.column-count')).map(\n            row => m('.Mason-Row', row.map(\n                item => m('.Mason-Column', item)\n            ))\n        )));\n    }\n}\n","/**\n * Split an array into multiple arrays of a given size\n * Useful for grid layouts\n * @see https://stackoverflow.com/a/10456644/3133038\n * @param {Array} items\n * @param {number} itemsPerChunk\n * @returns {Array}\n */\nexport default function (items, itemsPerChunk) {\n    let R = [];\n    for (let i = 0; i < items.length; i += itemsPerChunk) {\n        R.push(items.slice(i, i + itemsPerChunk));\n    }\n    return R;\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport ItemList from 'flarum/utils/ItemList';\nimport Component from 'flarum/Component';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\nimport FieldEditDropdown from './FieldEditDropdown';\nimport FieldEditText from './FieldEditText';\nimport FieldEditTags from './FieldEditTags';\nimport FieldGrid from './FieldGrid';\n\n/* global m */\n\nexport default class FieldsEditor extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.fields = sortByAttribute(app.store.all('mason-fields'));\n\n        // Index to quickly do a reverse lookup from answer to field\n        this.answerToFieldIndex = [];\n        this.fields.forEach(\n            field => {\n                field.suggested_answers().forEach(\n                    answer => {\n                        this.answerToFieldIndex[answer.id()] = field.id();\n                    }\n                );\n            }\n        );\n    }\n\n    view() {\n        return m('.Mason-Fields.Mason-Fields--editor', [\n            this.headItems().toArray(),\n            FieldGrid.component({\n                items: this.fieldItems().toArray(),\n            }),\n        ]);\n    }\n\n    updateSelection(field, fieldAnswers) {\n        // Keep only answers to other fields\n        let answers = this.attrs.answers.filter(\n            answer => {\n                const reverseFieldLookup = this.answerToFieldIndex[answer.id()];\n\n                // If the answer is not in the reverse lookup table it's probably a non-suggested (user) answer\n                // In that case the field should be linked in the relationship\n                if (typeof reverseFieldLookup === 'undefined') {\n                    return answer.field().id() !== field.id();\n                }\n\n                return reverseFieldLookup !== field.id();\n            }\n        );\n\n        answers = answers.concat(fieldAnswers);\n\n        this.attrs.onchange(answers);\n    }\n\n    headItems() {\n        const items = new ItemList();\n\n        if (app.forum.attribute('fof-mason.fields-section-title')) {\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('fof-mason.fields-section-title')));\n        }\n\n        return items;\n    }\n\n    fieldItems() {\n        const items = new ItemList();\n\n        if (app.forum.attribute('fof-mason.tags-as-fields')) {\n            items.add('tags', FieldEditTags.component({\n                discussion: this.attrs.discussion,\n                onchange: tags => {\n                    if (this.attrs.ontagchange) {\n                        this.attrs.ontagchange(tags);\n                    }\n                },\n            }));\n        }\n\n        this.fields.forEach(field => {\n            const inputAttrs = {\n                field,\n                answers: this.attrs.answers,\n                onchange: fieldAnswers => {\n                    // Every input component calls \"onchange\" with a list of answers from the store\n                    this.updateSelection(field, fieldAnswers);\n                },\n            };\n            let input = null;\n\n            if (field.user_values_allowed()) {\n                input = FieldEditText.component(inputAttrs);\n            } else {\n                input = FieldEditDropdown.component(inputAttrs);\n            }\n\n            items.add('field-' + field.id(), m('.Mason-Field.Form-group', {\n                className: app.forum.attribute('fof-mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\n            }, [\n                m('label', [\n                    (field.icon() ? [icon(field.icon()), ' '] : null),\n                    field.name(),\n                    (field.required() ? ' *' : null),\n                ]),\n                input,\n                (field.description() ? m('.helpText', field.description()) : null),\n            ]));\n        });\n\n        return items;\n    }\n}\n","import app from 'flarum/app';\nimport Modal from 'flarum/components/Modal';\nimport Button from 'flarum/components/Button';\nimport FieldsEditor from './FieldsEditor';\n\n/* global m */\n\nexport default class FieldsEditorModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.answers = this.attrs.discussion.masonAnswers();\n        this.dirty = false;\n        this.processing = false;\n\n        // Stays null if the feature is not used\n        this.tags = null;\n    }\n\n    title() {\n        return app.translator.trans('fof-mason.forum.answers-modal.edit-title', {\n            title: m('em', this.attrs.discussion.title()),\n        });\n    }\n\n    content() {\n        return [\n            m('.Modal-body', FieldsEditor.component({\n                discussion: this.attrs.discussion, // Only for the tags feature\n                answers: this.answers,\n                onchange: this.answersChanged.bind(this),\n                ontagchange: tags => {\n                    this.tags = tags;\n                    this.dirty = true;\n                },\n            })),\n            m('.Modal-footer', [\n                Button.component({\n                    className: 'Button Button--primary',\n                    loading: this.processing,\n                    disabled: !this.dirty,\n                    onclick: this.saveAnswers.bind(this),\n                }, app.translator.trans('fof-mason.forum.answers-modal.save')),\n            ]),\n        ];\n    }\n\n    answersChanged(answers) {\n        this.answers = answers;\n        this.dirty = true;\n    }\n\n    saveAnswers() {\n        this.processing = true;\n\n        let relationships = {\n            masonAnswers: this.answers,\n        };\n\n        // If tag edit is enabled, take care of them here as well\n        if (this.tags !== null) {\n            relationships.tags = this.tags;\n        }\n\n        this.attrs.discussion.save({\n            relationships,\n        }).then(() => {\n            this.processing = false;\n            app.modal.close();\n            m.redraw();\n        }).catch(err => {\n            this.processing = false;\n            throw err;\n        });\n    }\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport ItemList from 'flarum/utils/ItemList';\nimport Component from 'flarum/Component';\nimport Button from 'flarum/components/Button';\nimport FieldsEditorModal from './FieldsEditorModal';\nimport FieldGrid from './FieldGrid';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\n\n/* global m */\n\nexport default class FieldsViewer extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.fields = sortByAttribute(app.store.all('mason-fields'));\n        this.discussion = this.attrs.discussion;\n    }\n\n    view() {\n        const head = this.headItems().toArray();\n        const fields = this.fieldsItems().toArray();\n\n        // If all fields are hidden\n        // And either no controls are shown or the setting hides them\n        // We don't show the viewer\n        if (!fields.length && (!head.length || app.forum.attribute('fof-mason.hide-empty-fields-section'))) {\n            // We need to return an actual dom element or Flarum does not like it\n            return m('div');\n        }\n\n        return m('.Mason-Fields.Mason-Fields--viewer', [\n            head,\n            FieldGrid.component({\n                items: fields,\n            }),\n        ]);\n    }\n\n    headItems() {\n        const items = new ItemList();\n\n        if (this.discussion.canUpdateMasonAnswers()) {\n            items.add('edit', Button.component({\n                className: 'Button Mason-Fields--edit',\n                icon: 'fas fa-pen',\n                onclick: () => app.modal.show(FieldsEditorModal, {\n                    discussion: this.discussion,\n                }),\n            }, app.translator.trans('fof-mason.forum.discussion-controls.edit-answers')));\n        }\n\n        if (app.forum.attribute('fof-mason.fields-section-title')) {\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('fof-mason.fields-section-title')));\n        }\n\n        return items;\n    }\n\n    fieldsItems() {\n        const items = new ItemList();\n\n        this.fields.forEach(field => {\n            // Discussion answers to this field\n            const answers = sortByAttribute((this.discussion.masonAnswers() || []).filter(answer => {\n                // It's necessary to compare the field() relationship\n                // Because field.suggested_answers() won't contain new and user answers\n                return answer.field() && answer.field().id() === field.id();\n            }));\n\n            let answer_list = answers.map(answer => m('span.Mason-Inline-Answer', answer.content()));\n\n            if (answers.length === 0) {\n                if (field.show_when_empty()) {\n                    answer_list.push(m('em.Mason-Inline-Answer', app.translator.trans('fof-mason.forum.post-answers.no-answer')));\n                } else {\n                    // If the field has no answer and the setting is off we don't show it\n                    return;\n                }\n            }\n\n            items.add('field-' + field.id(), m('.Mason-Field.Form-group', [\n                m('label', [\n                    (field.icon() ? [icon(field.icon()), ' '] : null),\n                    field.name(),\n                ]),\n                m('.FormControl.Mason-Inline-Answers', answer_list),\n            ]));\n        });\n\n        return items;\n    }\n}\n","import {extend} from 'flarum/extend';\nimport app from 'flarum/app';\nimport CommentPost from 'flarum/components/CommentPost';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport FieldsViewer from './components/FieldsViewer';\n\nfunction showFieldsOnPost(post) {\n    // The CommentPost component is also visible on the user profile, but we don't want to render the fields there\n    if (!app.current.matches(DiscussionPage)) {\n        return false;\n    }\n\n    // We only add fields to the first post, and only if fields are not displayed in the hero\n    // TODO: what if the first post is deleted ?\n    return post.number() === 1 && !app.forum.attribute('fof-mason.fields-in-hero');\n}\n\nexport default function () {\n    extend(CommentPost.prototype, 'oninit', function () {\n        if (!this.attrs.post.discussion().canSeeMasonAnswers() || !showFieldsOnPost(this.attrs.post)) {\n            return;\n        }\n\n        this.subtree.check(() => {\n            // Create a string with all answer ids\n            // If answers change this string will be different\n            return (this.attrs.post.discussion().masonAnswers() || []).map(answer => {\n                // Sometimes answer will be undefined while the data is being saved in FieldsEditorModal\n                if (!answer) {\n                    return '';\n                }\n\n                // There is a time after discussion.save() is called but before the data included in response is parsed\n                // where Flarum will already have updated the relationship, but answer.field will be missing and this causes\n                // the field to be skipped in FieldsViewer. So we also need to check the load status of that relationship\n                return JSON.stringify([answer.id(), !!answer.field()]);\n            }).join(',');\n        });\n    });\n\n    extend(CommentPost.prototype, 'content', function (content) {\n        if (!this.attrs.post.discussion().canSeeMasonAnswers() || !showFieldsOnPost(this.attrs.post)) {\n            return;\n        }\n\n        const postHeaderIndex = content.findIndex(item => item.attrs && item.attrs.className === 'Post-header');\n\n        // Insert the new content just after the header\n        // or at the very beginning if the header is not found\n        content.splice(postHeaderIndex === -1 ? 0 : postHeaderIndex + 1, 0, FieldsViewer.component({\n            discussion: this.attrs.post.discussion(),\n        }));\n    });\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport Discussion from 'flarum/models/Discussion';\nimport Forum from 'flarum/models/Forum';\nimport Answer from './../lib/models/Answer';\nimport Field from './../lib/models/Field';\nimport addComposerFields from './addComposerFields';\nimport addFieldUpdateControl from './addFieldUpdateControl';\nimport addFieldsOnDiscussionHero from './addFieldsOnDiscussionHero';\nimport addFieldsOnDiscussionPost from './addFieldsOnDiscussionPost';\nimport patchModelIdentifier from \"./patchModelIdentifier\";\n\napp.initializers.add('fof-mason', app => {\n    app.store.models['mason-fields'] = Field;\n    app.store.models['mason-answers'] = Answer;\n\n    Discussion.prototype.masonAnswers = Model.hasMany('masonAnswers');\n    Discussion.prototype.canSeeMasonAnswers = Model.attribute('canSeeMasonAnswers');\n    Discussion.prototype.canUpdateMasonAnswers = Model.attribute('canUpdateMasonAnswers');\n    Forum.prototype.canFillMasonFields = Model.attribute('canFillMasonFields');\n\n    addComposerFields();\n    addFieldsOnDiscussionHero();\n    addFieldsOnDiscussionPost();\n    addFieldUpdateControl();\n    patchModelIdentifier();\n});\n","import {extend} from 'flarum/extend';\nimport app from 'flarum/app';\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\nimport FieldsEditor from './components/FieldsEditor';\n\nexport default function () {\n    DiscussionComposer.prototype.masonAnswers = [];\n\n    extend(DiscussionComposer.prototype, 'headerItems', function (items) {\n        if (!app.forum.canFillMasonFields()) {\n            return;\n        }\n\n        items.add('mason-fields', FieldsEditor.component({\n            answers: this.masonAnswers,\n            onchange: answers => {\n                this.masonAnswers = answers;\n            },\n            ontagchange: tags => {\n                this.composer.fields.tags = tags;\n            },\n        }));\n    });\n\n    extend(DiscussionComposer.prototype, 'data', function (data) {\n        if (!app.forum.canFillMasonFields()) {\n            return;\n        }\n\n        data.relationships = data.relationships || {};\n        data.relationships.masonAnswers = this.masonAnswers;\n    });\n}\n","import {extend} from 'flarum/extend';\nimport app from 'flarum/app';\nimport DiscussionHero from 'flarum/components/DiscussionHero';\nimport FieldsViewer from './components/FieldsViewer';\n\nexport default function () {\n    extend(DiscussionHero.prototype, 'items', function (items) {\n        if (!this.attrs.discussion.canSeeMasonAnswers() || !app.forum.attribute('fof-mason.fields-in-hero')) {\n            return;\n        }\n\n        items.add('mason-fields', FieldsViewer.component({\n            discussion: this.attrs.discussion,\n        }));\n    });\n}\n","import {extend} from 'flarum/extend';\nimport app from 'flarum/app';\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport Button from 'flarum/components/Button';\nimport FieldsEditorModal from './components/FieldsEditorModal';\n\nexport default function () {\n    extend(DiscussionControls, 'moderationControls', function (items, discussion) {\n        if (discussion.canUpdateMasonAnswers()) {\n            items.add('mason-update-answers', Button.component({\n                icon: 'fas fa-tag',\n                onclick: () => app.modal.show(FieldsEditorModal, {discussion}),\n            }, app.translator.trans('fof-mason.forum.discussion-controls.edit-answers')));\n        }\n    });\n}\n","import {override} from 'flarum/extend';\nimport Model from 'flarum/Model';\nimport Answer from './../lib/models/Answer';\n\nexport default function () {\n    override(Model, 'getIdentifier', function (original, model) {\n        // For Answers that don't yet exist, we include the content and the field relationship when calling the API\n        // That way they can be created server-side without making individual API requests for each answer\n        if (model instanceof Answer && !model.exists) {\n            return {\n                type: model.data.type,\n                attributes: {\n                    content: model.data.attributes.content,\n                },\n                relationships: {\n                    field: {\n                        data: Model.getIdentifier(model.data.relationships.field),\n                    },\n                },\n            };\n        }\n\n        // Default behaviour\n        return original(model);\n    })\n}\n"],"sourceRoot":""}